<!DOCTYPE html>
<html dir="ltr" lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- Tell the browser to be responsive to screen width -->
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <!-- Favicon icon -->
    <link rel="icon" type="image/png" sizes="16x16" href="../assets/images/prd.png" />
    <title>
        Home | Performance Summary
    </title>
    <!-- Custom CSS -->
    <link href="../assets/libs/select2/select2.min.css" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/pikaday/css/pikaday.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highcharts/8.1.1/css/highcharts.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">  // DataTable Css
    <link href="../dist/css/style.min.css" rel="stylesheet" />
    <link href="../dist/css/custom.css" rel="stylesheet" />
    <link href="../dist/css/main.css" rel="stylesheet" />

</head>

<body onload="renderAll(); window.fetchData();">
    <div class="preloader">
        <div class="lds-ripple">
            <div class="lds-pos"></div>
            <div class="lds-pos"></div>
        </div>
    </div>
    <div id="main-wrapper" style="margin-top: -1.2%;">
        <header class="topbar" data-navbarbg="skin5" id="header_target"></header>
        <aside class="left-sidebar" data-sidebarbg="skin5">
            <div class="scroll-sidebar">
                <nav class="sidebar-nav" id="nav_target"></nav>
            </div>
        </aside>
        <div class="page-wrapper">
            <div class="page-breadcrumb">
                <div class="row">
 <!--                    <div class="col-12 d-flex no-block align-items-center" id="filter_target">
                        <small class="text-bold">Filter:</small>
                         <div class="col-md-12 col-sm-12 col-xs-12">
                                </div> 
                    </div>
                </div> -->
            </div>
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12 p-0" id="status_target"> </div>
                    <div class="col-md-12 p-0" id="loading_target"> </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title table-title"> FY22 OU & USAID/KEA PERFORMANCE SUMMARY</h4>
                                <div class="" id="active">
                                    <table id="perf-table" class="display">
                                        <thead>
                                            <tr>
                                                <th> </th>
                                                <th colspan="2" class="col-table targets" >Targets</th>

                                                <th colspan="4" class="col-table q1" >Q1 + Q2</th>




                                                <!-- <th colspan="4" class="col-table q2" >Q2</th> -->



                                            </tr>
                                        </thead>
                                        <thead>
                                            <tr>
                                                <th> </th>
                                                <th  class="targets"> </th>
                                                <th class="targets"> </th>
                                                <th colspan="2" class="col-table q1" >OU</th>
                                                
                                                <th colspan="2" class="col-table q1" >USAID</th>

                                               <!-- <th colspan="2" class="col-table q2" >OU</th>

                                                <th colspan="2" class="col-table q2" >USAID</th> -->

                                            </tr>
                                        </thead>
                                        <thead>
                                            <tr>
                                                <th>Indicator</th>
                                                <th class="targets">OU</th>
                                                <th class="targets">USAID</th>
                                                <th class="q1">Achieved</th>
                                                <th class="q1">% Achieved</th>
                                                <th class="q1">Achieved</th>
                                                <th class="q1">% Achieved</th>
                                                <!-- <th class="q2">Achieved</th>
                                                <th class="q2">% Achieved</th>
                                                <th class="q2">Achieved</th>
                                                <th class="q2">% Achieved</th> -->
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Start of subheading HIV -->
                                            <tr>
                                                <td class="sub-title title-head"><strong>HIV/TB</strong></td>
                                                <td class="sub-title"></td>
                                                <td class="sub-title"></td>
                                                <td class="sub-title"></td>
                                                <td class="sub-title"></td>
                                                <td class="sub-title"></td>
                                                <td class="sub-title"></td>
                                                <!-- <td class="sub-title"></td>
                                                <td class="sub-title"></td>
                                                <td class="sub-title"></td>
                                                <td class="sub-title"></td> -->
                                            </tr>
                                            <tr id="HTS_TST">
                                                <td>HTS_TST</td>
                                                <td>4,508,339</td>
                                                <td>2,166,682</td>
                                                <td>1,852,777</td>
                                                <td>41 %</td>
                                                <td>773,682</td>
                                                <td>36 %</td>
                                                <!-- <td>0</td>
                                                <td>0</td>
                                                <td>0</td>
                                                <td>0</td> -->
                                            </tr>
                                            <tr Id="HTS_TST_POS">
                                                <!-- <td>HTS_TST_POS</td>
                                                <td>110,816</td>
                                                <td>49,019</td>
                                                <td>24,521</td>
                                                <td>22.13%</td>
                                                <td>9,726</td>
                                                <td>8.78%</td> -->
                                                <!-- <td>0</td>
                                                <td>0</td>
                                                <td>0</td>
                                                <td>0</td> -->
                                            </tr>                                       
                                            <tr id="PMTCT_ART">
                                                
                                                <!-- <td>PMTCT_ART</td>
                                                <td>52,557</td>
                                                <td>20,630</td>
                                                <td>11,029</td>
                                                <td>20.98%</td>
                                                <td>3,876</td>
                                                <td>7.37%</td> -->
                                                 <!-- <td>0</td>
                                                <td>0</td>
                                                <td>0</td>
                                                <td>0</td> -->
                                            </tr>

                                            <tr id="PMTCT_EID">
                                                <td>PMTCT_EID</td>
                                                <td>51,314</td>
                                                <td>20,324</td>
                                                <td>22,435</td>
                                                <td>44 %</td>
                                                <td>8,267</td>
                                                <td>41 %</td>
                                                <!-- <td>0</td>
                                                <td>0</td>
                                                <td>0</td>
                                                <td>0</td> -->
                                            </tr>
                                            <tr id="PMTCT_EID_Less_">
                                                <td>PMTCT_EID_Less_<br>Equal_Two_Months</td>
                                                <td>46,181</td>
                                                <td>18,289</td>
                                                <td>11,036</td>
                                                <td>24 %</td>
                                                <td>3,705</td>
                                                <td>20 %</td>
                                                <!-- <td>0</td>
                                                <td>0</td>
                                                <td>0</td>
                                                <td>0</td> -->

                                            </tr>
                                            <tr id="PMTCT_HEI_POS">
                                                <td>PMTCT_HEI_POS</td>
                                                <td></td>
                                                <td></td>
                                                <td>359</td>
                                                <td></td>
                                                <td>156</td>
                                                <td></td>
                                                <!-- <td>0</td>
                                                <td>0</td>
                                                <td>0</td>
                                                <td>0</td> -->
                                            </tr>

                                            <tr id="PMTCT_STAT">
                                                <!-- <td>PMTCT_STAT</td>
                                                <td>1,024,484</td>
                                                <td>548,413</td>
                                                <td>237,394</td>
                                                <td>23.17%</td>
                                                <td>125,082</td>
                                                <td>12.21%</td> -->
                                                <!-- <td>0</td>
                                                <td>0</td>
                                                <td>0</td>
                                                <td>0</td> -->
                                            </tr>
                                            <tr id="PMTCT_STAT_POS">
                                                <!-- <td>PMTCT_STAT_POS</td>
                                                <td>53,214</td>
                                                <td>20,957</td>
                                                <td>11,156</td>
                                                <td>20.96%</td>
                                                <td>3,940</td>
                                                <td>7.40%</td> -->
                                                <!-- <td>0</td>
                                                <td>0</td>
                                                <td>0</td>
                                                <td>0</td> -->

                                            </tr>
                                            <tr id="TB_ART">
                                                <!-- <td>TB_ART</td>
                                                <td>16,406</td>
                                                <td>7,060</td>
                                                <td></td>
                                                <td>0.00%</td>
                                                <td></td>
                                                <td>0.00%</td> -->
                                                <!-- <td>0</td>
                                                <td>0</td>
                                                <td>0</td>
                                                <td>0</td> -->
                                            </tr>
                                            <tr id="TB_STAT">
                                                <!-- <td>TB_STAT</td>
                                                <td>65,666</td>
                                                <td>30,617</td>
                                                <td>14,661</td>
                                                <td>22.33%</td>
                                                <td>6,607</td>
                                                <td>10.06%</td> -->
                                                <!-- <td>0</td>
                                                <td>0</td>
                                                <td>0</td>
                                                <td>0</td> -->
                                            </tr>
                                            <tr id="TB_STAT_POS">
                                                <!-- <td>TB_STAT_POS</td>
                                                <td>16,565</td>
                                                <td>7,109</td>
                                                <td>3,959</td>
                                                <td>23.90%</td>
                                                <td>1,488</td>
                                                <td>8.98%</td> -->
                                                <!-- <td>0</td>
                                                <td>0</td>
                                                <td>0</td>
                                                <td>0</td> -->
                                            </tr>
                                            <tr id="TX_CURR">
                                                <!-- <td>TX_CURR</td>
                                                <td>1,353,175</td>
                                                <td>470,373</td>
                                                <td>1,249,781</td>
                                                <td>92.36%</td>
                                                <td>421,659</td>
                                                <td>31.16%</td> -->
                                                <!-- <td>0</td>
                                                <td>0</td>
                                                <td>0</td>
                                                <td>0</td> -->
                                            </tr>
                                            <tr id="TX_NET_NEW">
                                                <td>TX_NET_NEW</td>
                                                <td></td>
                                                <td></td>
                                                <td>22,001</td>
                                                <td></td>
                                                <td>12,117</td>
                                                <td></td>
                                                <!-- <td>0</td>
                                                <td>0</td>
                                                <td>0</td>
                                                <td>0</td> -->
                                            </tr>
                                             <tr id="TX_NEW">
                                             <!--    <td>TX_NEW</td>
                                                <td>106,167</td>
                                                <td>46,943</td>
                                                <td>22,660</td>
                                                <td>21.34%</td>
                                                <td>9,113</td>
                                                <td>8.58%</td> -->
                                                <!-- <td>0</td>
                                                <td>0</td>
                                                <td>0</td>
                                                <td>0</td> -->
                                            </tr>
                                            <tr>
                                                <td>TX_PVLS (Suppression)</td>
                                                <td>337,749</td>
                                                <td>86,647</td>
                                                <td>322,477</td>
                                                <td>95 %</td>
                                                <td>82,015</td>
                                                <td>95 %</td>
                                                <!-- <td>0</td>
                                                <td>0</td>
                                                <td>0</td>
                                                <td>0</td>
                                            </tr>
                                            <!-- Subheading Family Health -->
                                            <tr>
                                                <td class="sub-title title-head"> <strong>Family Health</strong></td>
                                                <td class="sub-title"></td>
                                                <td class="sub-title"></td>
                                                <td class="sub-title"></td>
                                                <td class="sub-title"></td>
                                                <td class="sub-title"></td>
                                                <td class="sub-title"></td>
                                                <!-- <td class="sub-title"></td>
                                                <td class="sub-title"></td>
                                                <td class="sub-title"></td>
                                                <td class="sub-title"></td> -->
                                            </tr>
                                            <tr>
                                                <td>ANC 1 Coverage</td>
                                                <td class="non-active-row"></td>
                                                <td>498,207</td>
                                                <td class="non-active-row"></td>
                                                <td class="non-active-row"></td>
                                                <td>242,930</td>
                                                <td>49 %</td>
                                                <!-- <td>0</td>
                                                <td>0</td>
                                                <td>0</td>
                                                <td>0</td> -->
                                            </tr>
                                            <tr>
                                                <td>Skilled Birth Attendant</td>
                                                <td class="non-active-row"></td>
                                                <td>490,610</td>
                                                <td class="non-active-row"></td>
                                                <td class="non-active-row"></td>
                                                <td>198,923</td>
                                                <td>41 %</td>
                                                <!-- <td>0</td>
                                                <td>0</td>
                                                <td>0</td>
                                                <td>0</td> -->
                                            </tr>
                                            <tr>
                                                <td>Fully immunized Children</td>
                                                <td class="non-active-row"></td>
                                                <td>477,947</td>
                                                <td class="non-active-row"></td>
                                                <td class="non-active-row"></td>
                                                <td>200,550</td>
                                                <td>42 %</td>
                                                <!-- <td>0</td>
                                                <td>0</td>
                                                <td>0</td>
                                                <td>0</td> -->
                                            </tr>
                                            <!-- Subheading malaaria -->
                                            <tr>
                                                <td class="sub-title title-head"> <strong> Malaria </strong>  </td>
                                                <td class="sub-title"></td>
                                                <td class="sub-title"></td>
                                                <td class="sub-title"></td>
                                                <td class="sub-title"></td>
                                                <td class="sub-title"></td>
                                                <td class="sub-title"></td>
                                                <!-- <td class="sub-title"></td>
                                                <td class="sub-title"></td>
                                                <td class="sub-title"></td>
                                                <td class="sub-title"></td> -->
                                            </tr>
                                        </tbody>
                                    </table> 
                                    <p class="card-text"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

        </div>
    </div>
    </div>
    <div id="footer_target" class="p-0 m-0 w-100"></div>

    <script src="../assets/libs/jquery/dist/jquery.min.js"></script>
    <script src="../assets/libs/select2/select2.min.js"></script>
    <script src="../assets/libs/popper.js/dist/umd/popper.min.js"></script>
    <script src="../assets/libs/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="../assets/libs/perfect-scrollbar/dist/perfect-scrollbar.jquery.min.js"></script>
    <script src="../dist/js/sidebarmenu.js"></script>
    <script src="../dist/js/custom.js"></script>

    <!-- *********** <WeekPicker ************** -->
    <script src="https://cdn.jsdelivr.net/npm/moment@2.26.0/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pikaday/pikaday.js"></script>
    <script src="../dist/js/weekpicker.js"></script>
    <!-- *********** WeekPicker/> ************** -->

    <!-- *********** <Highcharts ************** -->
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/highcharts/8.1.1/es-modules/highcharts.src.min.js"></script>-->
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <!-- *********** Highcharts/> ************** -->

    <!-- ********** Datatables CDN ********** -->
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>
    <!-- ********** Datatables CDN ********** -->




    <!-- TEMPLATING -->
    <script src="../dist/js/templates/mustache.js"></script>

    <!-- templates -->
    <!-- <script id="header_template" type="x-tmpl-mustache">
                //html here
            </script> -->
    <script src="../dist/js/templates/components/footer.js"></script>
    <script src="../dist/js/templates/components/header.js"></script>
    <script src="../dist/js/templates/components/nav.js"></script>
    <script src="../dist/js/templates/components/filter.js"></script>
    <script src="../dist/js/templates/components/loading.js"></script>
    <script src="../dist/js/templates/components/status.js"></script>
    <!-- templates -->

    <!-- renders -->
    <script src="../dist/js/templates/renders.js"></script>
    <!-- renders -->

    <!-- render Fn -->
    <script>
     



        function renderAll() {
            let page_title = { title: 'Performance Summary' }
            let page_filters = {
                is_county: true,
                is_subcounty: false,
                is_ward: false,
                is_facility: false,
                is_period: false,
                is_mechanism: true,
                is_period_range: false,
                is_biweek: true,
                is_biweek_range: true
            }
            let is_loading = { is_loading: false }
            let footer_yr = { yr: new Date().getFullYear() }
            let page_status = { title: '', message: '', type: 'info', hidden: true } //type: info, success, danger

            renderNav()
            renderHeader(page_title)
            renderFooter(footer_yr)
            renderLoader(is_loading)
            // renderFilter(page_filters)
            renderStatus(page_status)
        }


    </script>
    <!-- render Fn -->
    <!-- TEMPLATING -->


    <script src="../dist/js/_utils.js"></script>
<!-- ------------------------ PAGE DATA LOGIC ------------------------ -->    

<script>
    const table = new DataTable('#perf-table',{

    });
</script>
<script>
    var finalpe 
        window.fetchData = (prop) => {

            // let org_unit = window.sessionStorage.getItem('ess_ou') || "HfVjCurKxh2"
            let org_unit = "HfVjCurKxh2"
            // var mechanism = ""
            if (prop && prop.ou) {
                org_unit = prop.ou
            }
            let prd = getPreviousPMonth()
            if (prop && prop.pe) {
                prd = prop.pe
            }
            if (prop && prop.pe && prop.pe_to) {
                prd = dateRange(prop.pe, prop.pe_to)
            }
            console.log('prd = = = ' + prd);

            let ouFilterType = window.sessionStorage.getItem("ouFilterType") || "national"
            finalpe = prd.replace(/,/g, ';');
            var cummulativeperiod;
            if (finalpe == `LAST_YEAR`) {
                var yr = `LAST_YEAR`
            } else {
                var yr = finalpe.substring(0, 4)
            }
            
            if (prop && prop.me) {
                mechanism = prop.me
            } else {
                mechanism = ""
            }
            // if (finalpe == `202110`){
            //     cummulativeperiod = `202001;202002;202003;202004;202005;202006;202007;202008;202009;202010;202011;202012;202101;202102;202103;202104;202105;202106;202107;202108;202109;202110;202111;202112;202201;202202;202203;202204;202205;202206;202207;202208;202209;202210;202211;202212`
            // }else{
            //     cummulativeperiod = finalpe
            // }

           
            function getPreviousPMonth() 
            {
                var curdate = new Date();

                var today = curdate.getDate();

                if(today<20)
                    curdate.setMonth(curdate.getMonth() - 2);
                else
                    curdate.setMonth(curdate.getMonth() - 1);

                per_y = curdate.getFullYear();
                per_m = parseFloat(curdate.getMonth());
                
                if(parseFloat(per_m) < 10){ per_m = "0"+per_m}
                
                var per = per_y+""+per_m;
                
                return per
                //return(getPerio(per, false))
             }

            // let onArtReview = `https://indextestingapp.uonbi.ac.ke/api/29/analytics.json?filter=lRp2LBbTuM5:${mechanism}&dimension=pe:${finalpe}&dimension=dx:UW4B21MEvlk;coV33AERzhA;NW1vrnCyzXd;AeFO4noHEDJ;SHBwx5cuUkx;bjJPCcuY65I&filter=ou:${org_unit}&displayProperty=NAME&outputIdScheme=UID`
            // // console.log(onArtReview)

            // let tx_curr_reviewed = `https://indextestingapp.uonbi.ac.ke/api/29/analytics.json?dimension=dx:UW4B21MEvlk;coV33AERzhA;B1vk3KZikA8&filter=lRp2LBbTuM5:${mechanism}&dimension=pe:${finalpe}&filter=ou:${org_unit}&displayProperty=NAME&outputIdScheme=UID`

            // let tx_curr_indexed = `https://indextestingapp.uonbi.ac.ke/api/29/analytics.json?dimension=dx:coV33AERzhA;NW1vrnCyzXd;vqJRbCXt2RG&filter=lRp2LBbTuM5:${mechanism}&dimension=pe:${finalpe}&filter=ou:${org_unit}&displayProperty=NAME&outputIdScheme=UID`

            // let ElicitationRation = `https://indextestingapp.uonbi.ac.ke/api/29/analytics.json?dimension=dx:NW1vrnCyzXd;YFyGrIvwLlh;hu3t3GedH0u&filter=lRp2LBbTuM5:${mechanism}&dimension=pe:${finalpe}&filter=ou:${org_unit}&displayProperty=NAME`

            // let testingYield = `https://indextestingapp.uonbi.ac.ke/api/29/analytics.json?dimension=dx:udHxOEAM9jP;qHxws7Glw97;lzcJMJA0AiX;sWThEZcSXNC;X6Wiw3Dj7sq&filter=lRp2LBbTuM5:${mechanism}&dimension=pe:${finalpe}&filter=ou:${org_unit}&displayProperty=NAME&outputIdScheme=UID`


            // let onArt = `https://indextestingapp.uonbi.ac.ke/api/29/analytics.json?dimension=dx:Fy6ziYuDQo3;HpsOgDcwl1P;hiKuwyHMcud&filter=lRp2LBbTuM5:${mechanism}&dimension=pe:${finalpe}&filter=ou:${org_unit}&displayProperty=NAME&outputIdScheme=UID`

            // let ovcenrollment = `https://indextestingapp.uonbi.ac.ke/api/29/analytics.json?dimension=dx:Fy6ziYuDQo3;HD8FN7bkMxp;UsRas7M570x;QsE9CIjZIHx;mVaipc7VCZs&filter=lRp2LBbTuM5:${mechanism}&dimension=pe:${finalpe}&filter=ou:${org_unit}&displayProperty=NAME&outputIdScheme=UID`

            // let qaCheck = `https://indextestingapp.uonbi.ac.ke/api/29/analytics.json?dimension=dx:xAWG6liDMUP;Hzb155t24g1&filter=lRp2LBbTuM5:${mechanism}&dimension=pe:${finalpe}&filter=ou:${org_unit}&displayProperty=NAME&outputIdScheme=UID`

            // let contactbyhivstatus = `https://indextestingapp.uonbi.ac.ke/api/29/analytics.json?dimension=dx:uEaonA39cPf;wJAoilEtQ97;lKYvovb7dFc&filter=lRp2LBbTuM5:${mechanism}&dimension=pe:${finalpe}&filter=ou:${org_unit}&displayProperty=NAME&outputIdScheme=UID`

            // let subpop = `https://indextestingapp.uonbi.ac.ke/api/29/analytics.json?dimension=dx:lRK71O8Ks8W;vdwkGEovm1n;nZDcqciPEHX&filter=lRp2LBbTuM5:${mechanism}&dimension=pe:${finalpe}&filter=ou:${org_unit}&displayProperty=NAME&outputIdScheme=UID`

            // let testingcoverage = `https://indextestingapp.uonbi.ac.ke/api/29/analytics.json?dimension=dx:lKYvovb7dFc;i4sOrA1zfrj;uWyFdcWMEvQ&filter=lRp2LBbTuM5:${mechanism}&dimension=pe:${finalpe}&filter=ou:${org_unit}&displayProperty=NAME&outputIdScheme=UID`

            // let testedresults = `https://indextestingapp.uonbi.ac.ke/api/29/analytics.json?dimension=dx:udHxOEAM9jP;sWThEZcSXNC;qHxws7Glw97;lzcJMJA0AiX&filter=lRp2LBbTuM5:${mechanism}&dimension=pe:${finalpe}&filter=ou:${org_unit}&displayProperty=NAME&outputIdScheme=UID`

            // let testingcascade = `https://indextestingapp.uonbi.ac.ke/api/29/analytics.json?dimension=dx:lKYvovb7dFc;QdNNAEz7ttE;kfQAWeTuKzW;iJPCXlPkPo6;GIpH4qaVeI8;s6LkY1Uuroj;XjMHcVmlLno;udHxOEAM9jP;VkJSCzLdnMc;HTt9Ur5B5Ig;uWyFdcWMEvQ&filter=lRp2LBbTuM5:${mechanism}&dimension=pe:${finalpe}&filter=ou:${org_unit}&displayProperty=NAME&outputIdScheme=UID`



            // getart_review(onArtReview)
            // getCurrentReviewed(tx_curr_reviewed)
            // getTxCurrindexed(tx_curr_indexed)
            // getElicitationRation(ElicitationRation)
            // getTestingYield(testingYield)
            // getOnArt(onArt)
            // getovcenrollment(ovcenrollment)
            // getQaCheck(qaCheck)
            // getContactbyStatus(contactbyhivstatus)
            // getSubPop(subpop)
            // getTestingCoverage(testingcoverage)
            // getTestedResult(testedresults)
            // getTestingCascade(testingcascade)




        }

        function periodRange(periodName) {
            let finalperiodName = []
            finalperiodName.push(periodName[0]);
            finalperiodName.push(periodName[periodName.length - 1]);

            return finalperiodName
        }

        function getart_review(url) {
            justFetch(url, {})
                .then(response => {

                    var cTitle = 'Patients on ART Review and Contact Listing'
                    var theorgunit = response.metaData.dimensions.ou[0];
                    var curorg = response.metaData.items[theorgunit].name;
                    var mechanism_length = response.metaData.dimensions.lRp2LBbTuM5
                    if (mechanism_length.length > 1){
                        var mechanismName = 'All Partners'
                    }else{
                        var mechanism = response.metaData.dimensions.lRp2LBbTuM5[0];
                        var mechanismName = response.metaData.items[mechanism].name;
                    }             
                    
                    var dx = response.metaData.dimensions.dx;
                    var pe = response.metaData.dimensions.pe;
                    var stacking = ''
                    var periodName = []
                    var dataRows = []

                    let dataToPlot = []

                    dataValues = Array.from(response.rows, r => r[3])
                    const { rows } = response
                    response.metaData.dimensions.pe.map(pe => {
                        periodName.push(response.metaData.items[pe].name)


                    })
                    const getDXName = (id) => {
                        return response.metaData.items[id].name

                    }
                    const toNumbers = arr => arr.map(Number);
                   
                    dx.map((d_x,ix)=>{
                        let datapoint = {}
                        datapoint.name = response.metaData.items[d_x].name
                        datapoint.data = []
                        datapoint.type = 'column'
                        pe.map(p_e=>{
                            let rw = response.rows.find(rw1=>rw1[response.headers.findIndex(jk => jk.name == "dx")] == d_x && rw1[response.headers.findIndex(jk => jk.name == "pe")] == p_e) || [0,0,0,0,0]
                            datapoint.data.push(parseFloat(rw[
                                response.headers.findIndex(jk => jk.name == "value")
                            ]))
                        })
                        dataToPlot.push(datapoint)
                    })
                    var fperiodName = periodRange(periodName)
                    
                    drawbargraphs('onArtReview', periodName, fperiodName, mechanismName, cTitle, dataToPlot, stacking)

                    
                    ////  Patients on Treatment Reviewed 
                    // console.log(dataToPlot[0].data.length)
                    let len = dataToPlot[0].data.length - 1
                    // console.log(len)
                    let tx_curr_val = dataToPlot.find(r=>r.name=="TX_Curr")?.data[len] || 0
                    let tx_curr_rev_val = dataToPlot.find(r=>r.name=="TX_curr reviewed")?.data[len] || 0
                    let contact_less_19 = dataToPlot.find(r=>r.name=="Contacts < 19 years")?.data[len] || 0
                    let tx_curr_contact_less_19 = dataToPlot.find(r=>r.name=="TX_CURR with contacts <19 years")?.data[len] || 0
                    let contacts_known_hiv = dataToPlot.find(r=>r.name=="Contacts Known HIV Status")?.data[len] || 0
                    
                    
                    $('#patients_reviewed').html( (parseFloat(tx_curr_rev_val)*100 / parseFloat(tx_curr_val)).toFixed(1)+'%' )
                    $('#contacts_19').html( (parseFloat(contact_less_19)*100 / parseFloat(tx_curr_val)).toFixed(1)+'%' )
                    $('#contact_ratio').html( (parseFloat(contact_less_19) / parseFloat(tx_curr_contact_less_19)).toFixed(1)+'' )
                    $('#baseline').html( (parseFloat(contacts_known_hiv)*100 / parseFloat(contact_less_19)).toFixed(1)+'%' )


                });
        }
        function getCurrentReviewed(url) {
            justFetch(url, {})
                .then(response => {
                    // console.log(response)
                    var cTitle = 'TX_CURR Reviewed'
                    var theorgunit = response.metaData.dimensions.ou[0];
                    var curorg = response.metaData.items[theorgunit].name;
                    var mechanism_length = response.metaData.dimensions.lRp2LBbTuM5
                    if (mechanism_length.length > 1){
                        var mechanismName = 'All Partners'
                    }else{
                        var mechanism = response.metaData.dimensions.lRp2LBbTuM5[0];
                        var mechanismName = response.metaData.items[mechanism].name;
                    }    
                    var dx = response.metaData.dimensions.dx;
                    var pe = response.metaData.dimensions.pe;
                    var periodName = []
                    var dataRows = []
                    var stacking = ''
                    let dataToPlot = []

                    dataValues = Array.from(response.rows, r => r[3])
                    const { rows } = response
                    response.metaData.dimensions.pe.map(pe => {
                        periodName.push(response.metaData.items[pe].name)


                    })
                    const getDXName = (id) => {
                        return response.metaData.items[id].name
                    }
                    const toNumbers = arr => arr.map(Number);
                    // console.log(pe)

                    dx.map((d_x,ix)=>{
                        let datapoint = {}
                        datapoint.name = response.metaData.items[d_x].name
                        datapoint.data = []
                        datapoint.type = 'column'
                        pe.map(p_e=>{
                            let rw = response.rows.find(rw1=>rw1[response.headers.findIndex(jk => jk.name == "dx")] == d_x && rw1[response.headers.findIndex(jk => jk.name == "pe")] == p_e) || [0,0,0,0,0]
                            datapoint.data.push(parseFloat(rw[
                                response.headers.findIndex(jk => jk.name == "value")
                            ]))
                        })
                        if (datapoint.name.toLowerCase().split(" ").join("_").includes("proportion_reviewed")) {
                                datapoint.type = 'spline'
                            }
                        dataToPlot.push(datapoint)
                    })
                   
                    var fperiodName = periodRange(periodName)
                    
                    drawSpines('tx_curr_reviewed', cTitle, periodName, fperiodName, mechanismName, dataToPlot, stacking)

                });
        }
        function getTestingCascade(url) {
            justFetch(url, {})
                .then(response => {
                    var cTitle = 'Testing Cascade'
                    var theorgunit = response.metaData.dimensions.ou[0];
                    var curorg = response.metaData.items[theorgunit].name;
                     var mechanism_length = response.metaData.dimensions.lRp2LBbTuM5
                    if (mechanism_length.length > 1){
                        var mechanismName = 'All Partners'
                    }else{
                        var mechanism = response.metaData.dimensions.lRp2LBbTuM5[0];
                        var mechanismName = response.metaData.items[mechanism].name;
                    }    
                    var dx = response.metaData.dimensions.dx;
                    var pe = response.metaData.dimensions.pe;
                    var periodName = []
                    var dataRows = []
                    var stacking = ''
                    let dataToPlot = []
                    var yAxis = 'Percentage'
                    var today = new Date()
                    var year = today.getFullYear()
                    var month = today.getMonth()
                    var todayMonth = `${year}${month}`
                    var periodsArray = []
                    
                    // if (finalpe == `LAST_6_MONTHS`){
                    // response.metaData.dimensions.pe.map(pe => {  
                    //     periodName.push(response.metaData.items[todayMonth].name)
                    // })}else{
                    //     response.metaData.dimensions.pe.map(pe => {  
                    //     periodsArray.push(pe)
                    // })
                    //    var lastPeriod = periodsArray.slice(-1).pop()
                    //    periodName.push(response.metaData.items[lastPeriod].name)
                    // }

                    dataValues = Array.from(response.rows, r => r[2])
                    const { rows } = response
                    response.metaData.dimensions.pe.map(pe => {
                        periodName.push(response.metaData.items[pe].name)


                    })
                    const getDXName = (id) => {
                        return response.metaData.items[id].name

                    }
                    const toNumbers = arr => arr.map(Number);
                  
                    // console.log(response.metaData.items)
                    dx.map((d_x,ix)=>{
                        let datapoint = {}
                        datapoint.name = response.metaData.items[d_x].name
                        datapoint.data = []
                        datapoint.type = 'column'
                        pe.map(p_e=>{
                            let rw = response.rows.find(rw1=>rw1[response.headers.findIndex(jk => jk.name == "dx")] == d_x && rw1[response.headers.findIndex(jk => jk.name == "pe")] == p_e) || [0,0,0,0,0]
                            datapoint.data.push(parseFloat(rw[
                                response.headers.findIndex(jk => jk.name == "value")
                            ]))
                        })
                        if (datapoint.name.toLowerCase().split(" ").join("_").includes("testing_cascade_proportion_contacted")) {                            
                                datapoint.type = 'spline'
                            }
                        else if (datapoint.name.toLowerCase().split(" ").join("_").includes("testing_cascade_proportion_consented")) {                            
                                datapoint.type = 'spline'
                            }
                        else if (datapoint.name.toLowerCase().split(" ").join("_").includes("testing_cascade_proportion_tested_with_results")) {                            
                                datapoint.type = 'spline'
                            }
                        else if (datapoint.name.toLowerCase().split(" ").join("_").includes("testing_cascade_proportion_reached")) {                            
                                datapoint.type = 'spline'
                            }
                        else {                            
                                datapoint.type = 'column'
                            }
                        dataToPlot.push(datapoint)
                    })
                    
                    // dx.map(id=>{

                    //         const data= rows.filter(row=>{
                    //             return row[0] === id 
                    //         })
                           
                    //     if (data.length > 1){

                    //                 const data1 = data.filter(datas=>{
                    //                     return datas[0] === id
                    //                 })
                                 
                    //         let dataSM = Array.from(data1, r=>r[2])
                    //         let fData = toNumbers(dataSM)
                           
                    //     if (data[0] !== undefined){
                                
                    //         if(data[0][0]==="kfQAWeTuKzW"){
                    //         graphdata={"type":'scatter',"name":getDXName(id), "data":fData}
                    //         dataToPlot.push(graphdata)
                    //         }else if(data[0][0]==="XjMHcVmlLno"){
                    //         graphdata={"type":'scatter',"name":getDXName(id), "data":fData}
                    //         dataToPlot.push(graphdata)
                    //         }else if(data[0][0]==="VkJSCzLdnMc"){
                    //         graphdata={"type":'scatter',"name":getDXName(id), "data":fData}
                    //         dataToPlot.push(graphdata)
                    //         }else if(data[0][0]==="GIpH4qaVeI8"){
                    //         graphdata={"type":'scatter',"name":getDXName(id), "data":fData}
                    //         dataToPlot.push(graphdata)
                    //         }else{
                    //         graphdata={"type":'column',"name":getDXName(id), "data":fData}
                    //         dataToPlot.push(graphdata)

                    //         }}

                    //     }else{
                    //     if (data[0] !== undefined){
                    //         if (data[0][0]==="kfQAWeTuKzW"){
                    //         graphdata={"type":'scatter',"name":getDXName(id), "data":[parseInt(data[0][2])]}
                    //         dataToPlot.push(graphdata)
                    //         }else if(data[0][0]==="XjMHcVmlLno"){
                    //         graphdata={"type":'scatter',"name":getDXName(id), "data":[parseInt(data[0][2])]}
                    //         dataToPlot.push(graphdata)
                    //         }else if(data[0][0]==="VkJSCzLdnMc"){
                    //         graphdata={"type":'scatter',"name":getDXName(id), "data":[parseInt(data[0][2])]}
                    //         dataToPlot.push(graphdata)
                    //         }else if(data[0][0]==="GIpH4qaVeI8"){
                    //         graphdata={"type":'scatter',"name":getDXName(id), "data":[parseInt(data[0][2])]}
                    //         dataToPlot.push(graphdata)
                    //         } else{                        
                    //         graphdata={"type":'column',"name":getDXName(id), "data":[parseInt(data[0][2])]}
                    //         dataToPlot.push(graphdata)

                    //         }
                    //         }
                    //         }
                    //         })
                    var fperiodName = periodRange(periodName)
                    

                    drawTestingCascade('testing_cascade', cTitle, periodName, fperiodName, mechanismName, dataToPlot, stacking, yAxis)

                });
        }

        function getTxCurrindexed(url) {
            justFetch(url, {})
                .then(response => {
                    var cTitle = 'tx_curr indexed'
                    var theorgunit = response.metaData.dimensions.ou[0];
                    var curorg = response.metaData.items[theorgunit].name;
                     var mechanism_length = response.metaData.dimensions.lRp2LBbTuM5
                    if (mechanism_length.length > 1){
                        var mechanismName = 'All Partners'
                    }else{
                        var mechanism = response.metaData.dimensions.lRp2LBbTuM5[0];
                        var mechanismName = response.metaData.items[mechanism].name;
                    }    
                    var dx = response.metaData.dimensions.dx;
                    var pe = response.metaData.dimensions.pe;
                    var periodName = []
                    var stacking = ''
                    var dataRows = []
                    var yAxis = 'Proportions'
                    let dataToPlot = []

                    dataValues = Array.from(response.rows, r => r[3])
                    const { rows } = response
                    response.metaData.dimensions.pe.map(pe => {
                        periodName.push(response.metaData.items[pe].name)


                    })
                    const getDXName = (id) => {
                        return response.metaData.items[id].name

                    }
                    const toNumbers = arr => arr.map(Number);

                    dx.map((d_x,ix)=>{
                        let datapoint = {}
                        datapoint.name = response.metaData.items[d_x].name
                        datapoint.data = []
                        datapoint.type = 'column'
                        pe.map(p_e=>{
                            let rw = response.rows.find(rw1=>rw1[response.headers.findIndex(jk => jk.name == "dx")] == d_x && rw1[response.headers.findIndex(jk => jk.name == "pe")] == p_e) || [0,0,0,0,0]
                            datapoint.data.push(parseFloat(rw[
                                response.headers.findIndex(jk => jk.name == "value")
                            ]))
                        })
                        // console.log(datapoint.name.toLowerCase().split(" ").join("_"))
                        if (datapoint.name.toLowerCase().split(" ").join("_").includes("proportion_of_tx_curr_with_contacts_<19_yo")) {
                            
                                datapoint.type = 'spline'
                            }
                        dataToPlot.push(datapoint)
                    })

                    var fperiodName = periodRange(periodName)
                    
                    drawSpines('tx_curr_indexed', cTitle, periodName, fperiodName, mechanismName, dataToPlot, stacking, yAxis)

                });
        }

        function getElicitationRation(url) {
            justFetch(url, {})
                .then(response => {
                    var cTitle = 'Elicitation Ration'
                    var theorgunit = response.metaData.dimensions.ou[0];
                    var curorg = response.metaData.items[theorgunit].name;
                     var mechanism_length = response.metaData.dimensions.lRp2LBbTuM5
                    if (mechanism_length.length > 1){
                        var mechanismName = 'All Partners'
                    }else{
                        var mechanism = response.metaData.dimensions.lRp2LBbTuM5[0];
                        var mechanismName = response.metaData.items[mechanism].name;
                    }    
                    var dx = response.metaData.dimensions.dx;
                    var pe = response.metaData.dimensions.pe;
                    var periodName = []
                    var dataRows = []
                    var stacking = ''
                    let dataToPlot = []
                    var yAxis = 'Ration'
                    dataValues = Array.from(response.rows, r => r[3])
                    const { rows } = response
                    response.metaData.dimensions.pe.map(pe => {
                        periodName.push(response.metaData.items[pe].name)


                    })
                    const getDXName = (id) => {
                        return response.metaData.items[id].name

                    }
                    const toNumbers = arr => arr.map(Number);

                     dx.map((d_x,ix)=>{
                        let datapoint = {}
                        datapoint.name = response.metaData.items[d_x].name
                        datapoint.data = []
                        datapoint.type = 'column'
                        pe.map(p_e=>{
                            let rw = response.rows.find(rw1=>rw1[response.headers.findIndex(jk => jk.name == "dx")] == d_x && rw1[response.headers.findIndex(jk => jk.name == "pe")] == p_e) || [0,0,0,0,0]
                            datapoint.data.push(parseFloat(rw[
                                response.headers.findIndex(jk => jk.name == "value")
                            ]))
                        })
                        // console.log(datapoint.name.toLowerCase().split(" ").join("_"))
                        if (datapoint.name.toLowerCase().split(" ").join("_").includes("elicitation_ratio")) {
                            
                                datapoint.type = 'spline'
                            }
                        dataToPlot.push(datapoint)
                    })
                    var fperiodName = periodRange(periodName)
                    
                    drawSpines('ElicitationRation', cTitle, periodName, fperiodName, mechanismName, dataToPlot, stacking, yAxis)

                });
        }


        function getTestingYield(url) {
            justFetch(url, {})
                .then(response => {
                    var cTitle = 'Testing and Yield (cumulative)'
                    var theorgunit = response.metaData.dimensions.ou[0];
                    var curorg = response.metaData.items[theorgunit].name;
                     var mechanism_length = response.metaData.dimensions.lRp2LBbTuM5
                    if (mechanism_length.length > 1){
                        var mechanismName = 'All Partners'
                    }else{
                        var mechanism = response.metaData.dimensions.lRp2LBbTuM5[0];
                        var mechanismName = response.metaData.items[mechanism].name;
                    }    
                    var dx = response.metaData.dimensions.dx;
                    var pe = response.metaData.dimensions.pe;
                    
                    var yAxis = 'Yield'
                    var periodName = []
                    var dataRows = []

                    let dataToPlot = []

                    dataValues = Array.from(response.rows, r => r[3])
                    const { rows } = response
                    var today = new Date()
                    var year = today.getFullYear()
                    var month = today.getMonth()
                    var todayMonth = `${year}${month}`
                    var periodsArray = []
                    
                    // if (finalpe == `LAST_6_MONTHS`){
                    // response.metaData.dimensions.pe.map(pe => {  
                    //     periodName.push(response.metaData.items[todayMonth].name)
                    // })}else{
                    //     response.metaData.dimensions.pe.map(pe => {  
                    //     periodsArray.push(pe)
                    // })
                    //    var lastPeriod = periodsArray.slice(-1).pop()
                    //    periodName.push(response.metaData.items[lastPeriod].name)
                    // }
                    response.metaData.dimensions.pe.map(pe => {
                        periodName.push(response.metaData.items[pe].name)


                    })
                    const getDXName = (id) => {
                        return response.metaData.items[id].name

                    }
                    const toNumbers = arr => arr.map(Number);
                    

                    

                    //console.log(response.headers)
                    dx.map((d_x,ix)=>{
                        let datapoint = {}
                        datapoint.name = response.metaData.items[d_x].name
                        datapoint.data = []
                        datapoint.type = 'column'
                        pe.map(p_e=>{
                            let rw = response.rows.find(rw1=>rw1[response.headers.findIndex(jk => jk.name == "dx")] == d_x && rw1[response.headers.findIndex(jk => jk.name == "pe")] == p_e) || [0,0,0,0,0]
                            datapoint.data.push(parseFloat(rw[
                                response.headers.findIndex(jk => jk.name == "value")
                            ]))
                        })
                        // console.log(datapoint.name.toLowerCase().split(" ").join("_"))
                        
                        if (datapoint.name.toLowerCase().split(" ").join("_").includes("yield")) {
                            
                                datapoint.type = 'spline'
                            }
                        dataToPlot.push(datapoint)
                    })
                    var fperiodName = periodRange(periodName)
                    
                    drawmultipleSpines('testing_yield', cTitle, periodName, fperiodName, mechanismName, dataToPlot, yAxis)

                });

        }

        function getOnArt(url) {
            justFetch(url, {})
                .then(response => {
                    var cTitle = 'On ART Cumulative'
                    var theorgunit = response.metaData.dimensions.ou[0];
                    var curorg = response.metaData.items[theorgunit].name;
                     var mechanism_length = response.metaData.dimensions.lRp2LBbTuM5
                    if (mechanism_length.length > 1){
                        var mechanismName = 'All Partners'
                    }else{
                        var mechanism = response.metaData.dimensions.lRp2LBbTuM5[0];
                        var mechanismName = response.metaData.items[mechanism].name;
                    }    
                    var dx = response.metaData.dimensions.dx;
                    var pe = response.metaData.dimensions.pe;
                    var yAxis = 'Linkage'
                    var stacking = ''
                    var periodName = []
                    var dataRows = []

                    let dataToPlot = []

                    dataValues = Array.from(response.rows, r => r[3])
                    var today = new Date()
                    var year = today.getFullYear()
                    var month = today.getMonth()
                    var todayMonth = `${year}${month}`
                    var periodsArray = []
                    
                    // if (finalpe == `LAST_6_MONTHS`){
                    // response.metaData.dimensions.pe.map(pe => {  
                    //     periodName.push(response.metaData.items[todayMonth].name)
                    // })}else{
                    //     response.metaData.dimensions.pe.map(pe => {  
                    //     periodsArray.push(pe)
                    // })
                    //    var lastPeriod = periodsArray.slice(-1).pop()
                    //    periodName.push(response.metaData.items[lastPeriod].name)
                    // }
                    response.metaData.dimensions.pe.map(pe => {
                        periodName.push(response.metaData.items[pe].name)


                    })
                    const { rows } = response
                    
                    const getDXName = (id) => {
                        return response.metaData.items[id].name

                    }
                    const toNumbers = arr => arr.map(Number);
                    // console.log(pe)

                    
                    dx.map((d_x,ix)=>{
                        let datapoint = {}
                        datapoint.name = response.metaData.items[d_x].name
                        datapoint.data = []
                        datapoint.type = 'column'
                        pe.map(p_e=>{
                            let rw = response.rows.find(rw1=>rw1[response.headers.findIndex(jk => jk.name == "dx")] == d_x && rw1[response.headers.findIndex(jk => jk.name == "pe")] == p_e) || [0,0,0,0,0]
                            // console.log(d_x)
                            datapoint.data.push(parseFloat(rw[
                                response.headers.findIndex(jk => jk.name == "value")
                            ]))
                        })
                        // console.log(datapoint.name.toLowerCase().split(" ").join("_"))
                        
                        if (datapoint.name.toLowerCase().split(" ").join("_").includes("linkage")) {
                            
                                datapoint.type = 'spline'
                            }
                        dataToPlot.push(datapoint)
                    })
                    var fperiodName = periodRange(periodName)
                    
                    drawSpines('on_art', cTitle, periodName, fperiodName, mechanismName, dataToPlot, stacking, yAxis)

                });

        }

        function getovcenrollment(url) {
            justFetch(url, {})
                .then(response => {

                    var cTitle = 'OVC enrollment (Cumulative)'
                    var theorgunit = response.metaData.dimensions.ou[0];
                    var curorg = response.metaData.items[theorgunit].name;
                     var mechanism_length = response.metaData.dimensions.lRp2LBbTuM5
                    if (mechanism_length.length > 1){
                        var mechanismName = 'All Partners'
                    }else{
                        var mechanism = response.metaData.dimensions.lRp2LBbTuM5[0];
                        var mechanismName = response.metaData.items[mechanism].name;
                    }    
                    var dx = response.metaData.dimensions.dx;
                    var pe = response.metaData.dimensions.pe;
                    var stacking = ''
                    var periodName = []
                    var dataRows = []

                    let dataToPlot = []
                    var today = new Date()
                    var year = today.getFullYear()
                    var month = today.getMonth()
                    var todayMonth = `${year}${month}`
                    var periodsArray = []
                    
                    if (finalpe == `LAST_6_MONTHS`){
                    response.metaData.dimensions.pe.map(pe => {  
                        periodName.push(response.metaData.items[todayMonth].name)
                    })}else{
                        response.metaData.dimensions.pe.map(pe => {  
                        periodsArray.push(pe)
                    })
                       var lastPeriod = periodsArray.slice(-1).pop()
                       periodName.push(response.metaData.items[lastPeriod].name)
                    }

                    dataValues = Array.from(response.rows, r => r[2])
                    const { rows } = response
                    response.metaData.dimensions.pe.map(pe => {
                        periodName.push(response.metaData.items[pe].name)


                    })
                    const getDXName = (id) => {
                        return response.metaData.items[id].name

                    }
                    
                    const toNumbers = arr => arr.map(Number);
 
                    dx.map((d_x,ix)=>{
                        let datapoint = {}
                        datapoint.name = response.metaData.items[d_x].name
                        datapoint.data = []
                        datapoint.type = 'column'
                        pe.map(p_e=>{
                            let rw = response.rows.find(rw1=>rw1[response.headers.findIndex(jk => jk.name == "dx")] == d_x && rw1[response.headers.findIndex(jk => jk.name == "pe")] == p_e) || [0,0,0,0,0]
                            datapoint.data.push(parseFloat(rw[
                                response.headers.findIndex(jk => jk.name == "value")
                            ]))
                        })
                        
                        dataToPlot.push(datapoint)
                    })
                //     dx.map(id=>{
                      
                //       const data= rows.filter(row=>{
                //           return row[0] === id 
                //       }) 
                //       if (data.length > 1){
                      
                //               const data1 = data.filter(datas=>{
                //                   return datas[0] === id
                //               })
                             
                //       let dataSM = Array.from(data1, r=>r[3])
                //       let fData = toNumbers(dataSM)
                //       graphdata={"name":getDXName(id), "data":fData}
                //       dataToPlot.push(graphdata)
                //       }else{
                //       if (data[0] !== undefined){
                //       graphdata={"name":getDXName(id), "data":[parseInt(data[0][2])]}
                //       dataToPlot.push(graphdata)
                //   }
                //   }
                //   })
                    
                var fperiodName = periodRange(periodName)
                    
                    drawbargraphs('ovc_enrollment', periodName, fperiodName, mechanismName, cTitle, dataToPlot, stacking)

                });

        }

        function getQaCheck(url) {
            justFetch(url, {})
                .then(response => {

                    var cTitle = 'QA check on contacts'
                    var theorgunit = response.metaData.dimensions.ou[0];
                    var curorg = response.metaData.items[theorgunit].name;
                     var mechanism_length = response.metaData.dimensions.lRp2LBbTuM5
                    if (mechanism_length.length > 1){
                        var mechanismName = 'All Partners'
                    }else{
                        var mechanism = response.metaData.dimensions.lRp2LBbTuM5[0];
                        var mechanismName = response.metaData.items[mechanism].name;
                    }    
                    var dx = response.metaData.dimensions.dx;
                    var pe = response.metaData.dimensions.pe;
                    var stacking = ''
                    var periodName = []
                    var dataRows = []

                    let dataToPlot = []

                    dataValues = Array.from(response.rows, r => r[3])
                    const { rows } = response
                    response.metaData.dimensions.pe.map(pe => {
                        periodName.push(response.metaData.items[pe].name)


                    })
                    const getDXName = (id) => {
                        return response.metaData.items[id].name

                    }
                    const toNumbers = arr => arr.map(Number);

                    dx.map((d_x,ix)=>{
                        let datapoint = {}
                        datapoint.name = response.metaData.items[d_x].name
                        datapoint.data = []
                        datapoint.type = 'column'
                        pe.map(p_e=>{
                            let rw = response.rows.find(rw1=>rw1[response.headers.findIndex(jk => jk.name == "dx")] == d_x && rw1[response.headers.findIndex(jk => jk.name == "pe")] == p_e) || [0,0,0,0,0]
                            datapoint.data.push(parseFloat(rw[
                                response.headers.findIndex(jk => jk.name == "value")
                            ]))
                        })
                        
                        dataToPlot.push(datapoint)
                    })
                    var fperiodName = periodRange(periodName)
                    
                    drawbargraphs('qa_check', periodName, fperiodName, mechanismName, cTitle, dataToPlot, stacking)

                });

        }

        function getContactbyStatus(url) {
            justFetch(url, {})
                .then(response => {

                    var cTitle = 'Contacts by HIV Status'
                    var theorgunit = response.metaData.dimensions.ou[0];
                    var curorg = response.metaData.items[theorgunit].name;
                     var mechanism_length = response.metaData.dimensions.lRp2LBbTuM5
                    if (mechanism_length.length > 1){
                        var mechanismName = 'All Partners'
                    }else{
                        var mechanism = response.metaData.dimensions.lRp2LBbTuM5[0];
                        var mechanismName = response.metaData.items[mechanism].name;
                    }    
                    var dx = response.metaData.dimensions.dx;
                    var pe = response.metaData.dimensions.pe;
                    var stacking = 'normal'
                    var periodName = []
                    var dataRows = []

                    let dataToPlot = []

                    dataValues = Array.from(response.rows, r => r[3])
                    const { rows } = response
                    response.metaData.dimensions.pe.map(pe => {
                        periodName.push(response.metaData.items[pe].name)


                    })
                    const getDXName = (id) => {
                        return response.metaData.items[id].name

                    }
                    const toNumbers = arr => arr.map(Number);
     
                    dx.map((d_x,ix)=>{
                        let datapoint = {}
                        datapoint.name = response.metaData.items[d_x].name
                        datapoint.data = []
                        datapoint.type = 'column'
                        pe.map(p_e=>{
                            let rw = response.rows.find(rw1=>rw1[response.headers.findIndex(jk => jk.name == "dx")] == d_x && rw1[response.headers.findIndex(jk => jk.name == "pe")] == p_e) || [0,0,0,0,0]
                            datapoint.data.push(parseFloat(rw[
                                response.headers.findIndex(jk => jk.name == "value")
                            ]))
                        })
                       
                        dataToPlot.push(datapoint)
                    })
                    var fperiodName = periodRange(periodName)
                    
                    drawbargraphs('contact_hiv_status', periodName, fperiodName, mechanismName, cTitle, dataToPlot, stacking)

                });

        }

        function getSubPop(url) {
            justFetch(url, {})
                .then(response => {

                    var cTitle = 'TX_CURR reviewed by sub population'
                    var theorgunit = response.metaData.dimensions.ou[0];
                    var curorg = response.metaData.items[theorgunit].name;
                     var mechanism_length = response.metaData.dimensions.lRp2LBbTuM5
                    if (mechanism_length.length > 1){
                        var mechanismName = 'All Partners'
                    }else{
                        var mechanism = response.metaData.dimensions.lRp2LBbTuM5[0];
                        var mechanismName = response.metaData.items[mechanism].name;
                    }    
                    var dx = response.metaData.dimensions.dx;
                    var pe = response.metaData.dimensions.pe;
                    var stacking = 'normal'
                    var periodName = []
                    var dataRows = []

                    let dataToPlot = []

                    dataValues = Array.from(response.rows, r => r[3])
                    const { rows } = response
                    response.metaData.dimensions.pe.map(pe => {
                        periodName.push(response.metaData.items[pe].name)


                    })
                    const getDXName = (id) => {
                        return response.metaData.items[id].name

                    }
                    const toNumbers = arr => arr.map(Number);


                    dx.map((d_x,ix)=>{
                        let datapoint = {}
                        datapoint.name = response.metaData.items[d_x].name
                        datapoint.data = []
                        datapoint.type = 'column'
                        pe.map(p_e=>{
                            let rw = response.rows.find(rw1=>rw1[response.headers.findIndex(jk => jk.name == "dx")] == d_x && rw1[response.headers.findIndex(jk => jk.name == "pe")] == p_e) || [0,0,0,0,0]
                            datapoint.data.push(parseFloat(rw[
                                response.headers.findIndex(jk => jk.name == "value")
                            ]))
                        })
                        if (datapoint.name.toLowerCase().split(" ").join("_").includes("proportion_reviewed")) {
                                datapoint.type = 'spline'
                            }
                        dataToPlot.push(datapoint)
                    })
                   

                    var fperiodName = periodRange(periodName)
                    
                    drawbargraphs('tx_curr_reviewed_subpop', periodName, fperiodName, mechanismName, cTitle, dataToPlot, stacking)

                });

        }

        function getTestingCoverage(url) {
            justFetch(url, {})
                .then(response => {
                    var cTitle = 'Testing Coverage'
                    var theorgunit = response.metaData.dimensions.ou[0];
                    var curorg = response.metaData.items[theorgunit].name;
                     var mechanism_length = response.metaData.dimensions.lRp2LBbTuM5
                    if (mechanism_length.length > 1){
                        var mechanismName = 'All Partners'
                    }else{
                        var mechanism = response.metaData.dimensions.lRp2LBbTuM5[0];
                        var mechanismName = response.metaData.items[mechanism].name;
                    }    
                    var dx = response.metaData.dimensions.dx;
                    var pe = response.metaData.dimensions.pe;
                    var stacking = 'normal'
                    var periodName = []
                    var dataRows = []

                    let dataToPlot = []

                    dataValues = Array.from(response.rows, r => r[3])
                    const { rows } = response
                    response.metaData.dimensions.pe.map(pe => {
                        periodName.push(response.metaData.items[pe].name)


                    })
                    const getDXName = (id) => {
                        return response.metaData.items[id].name

                    }
                    const toNumbers = arr => arr.map(Number);


                    dx.map((d_x,ix)=>{
                        let datapoint = {}
                        datapoint.name = response.metaData.items[d_x].name
                        datapoint.data = []
                        datapoint.type = 'column'
                        pe.map(p_e=>{
                            let rw = response.rows.find(rw1=>rw1[response.headers.findIndex(jk => jk.name == "dx")] == d_x && rw1[response.headers.findIndex(jk => jk.name == "pe")] == p_e) || [0,0,0,0,0]
                            datapoint.data.push(parseFloat(rw[
                                response.headers.findIndex(jk => jk.name == "value")
                            ]))
                        })
                        // console.log(datapoint.name.toLowerCase().split(" ").join("_"))
                        if (datapoint.name.toLowerCase().split(" ").join("_").includes("testing_coverage")) {
                            
                                datapoint.type = 'spline'
                            }
                        dataToPlot.push(datapoint)
                    })
                    var fperiodName = periodRange(periodName)
                    
                    drawSpines('testing_coverage', cTitle, periodName, fperiodName, mechanismName, dataToPlot, stacking)

                });
        }

        function getTestedResult(url) {
            justFetch(url, {})
                .then(response => {
                    var cTitle = 'Tested vs Tested with Results'
                    var theorgunit = response.metaData.dimensions.ou[0];
                    var curorg = response.metaData.items[theorgunit].name;
                     var mechanism_length = response.metaData.dimensions.lRp2LBbTuM5
                    if (mechanism_length.length > 1){
                        var mechanismName = 'All Partners'
                    }else{
                        var mechanism = response.metaData.dimensions.lRp2LBbTuM5[0];
                        var mechanismName = response.metaData.items[mechanism].name;
                    }    
                    var dx = response.metaData.dimensions.dx;
                    var pe = response.metaData.dimensions.pe;
                    var stacking = 'normal'
                    var periodName = []
                    var dataRows = []

                    let dataToPlot = []

                    dataValues = Array.from(response.rows, r => r[3])
                    const { rows } = response
                    response.metaData.dimensions.pe.map(pe => {
                        periodName.push(response.metaData.items[pe].name)


                    })
                    const getDXName = (id) => {
                        return response.metaData.items[id].name

                    }
                    const toNumbers = arr => arr.map(Number);

                    dx.map((d_x,ix)=>{
                        let datapoint = {}
                        datapoint.name = response.metaData.items[d_x].name
                        datapoint.data = []
                        datapoint.type = 'column'
                        datapoint.stack = []
                        pe.map(p_e=>{
                            let rw = response.rows.find(rw1=>rw1[response.headers.findIndex(jk => jk.name == "dx")] == d_x && rw1[response.headers.findIndex(jk => jk.name == "pe")] == p_e) || [0,0,0,0,0]
                            datapoint.data.push(parseFloat(rw[
                                response.headers.findIndex(jk => jk.name == "value")
                            ]))
                        })
                        // console.log(datapoint.name.toLowerCase().split(" ").join("_"))
                        if (datapoint.name.toLowerCase().split(" ").join("_").includes("tested")) {
                            
                            datapoint.stack = 'yes'
                            }
                        dataToPlot.push(datapoint)
                    })
                    // console.log(dataToPlot)
                    var fperiodName = periodRange(periodName)
                    
                    // console.log(dataToPlot)
                    drawbargraphs('tested_results', periodName, fperiodName, mechanismName, cTitle, dataToPlot, stacking)

                });

        }
    console.log('table')


    // to fet usaid percentage achieved
    // justFetch(`https://indextestingapp.uonbi.ac.ke/api/29/analytics.json?dimension=pe:LAST_4_QUARTERS&dimension=dx:Hv1GYO3LEhd.vfYirA3SzWq;Hv1GYO3LEhd.gEMvNvc0hMk;ams5aL2ggzT.vfYirA3SzWq;cmMCBDhNvYW;ams5aL2ggzT.gEMvNvc0hMk;qw4ajKxYnlE;gYFPVpai0iO.vfYirA3SzWq;gYFPVpai0iO.gEMvNvc0hMk;wkAvecy6Ot6.vfYirA3SzWq;rxqodNFVPY3;wkAvecy6Ot6.gEMvNvc0hMk;sPd0JmN9x7R;VJDwoa58SBc.vfYirA3SzWq;VJDwoa58SBc.gEMvNvc0hMk;TByJo5nHKtZ.vfYirA3SzWq;DkKA6JazvZx;TByJo5nHKtZ.gEMvNvc0hMk;Bs3gPxKyViP;D98g1LXwUA8.vfYirA3SzWq;D98g1LXwUA8.gEMvNvc0hMk;m99lZ4ECtqb.vfYirA3SzWq;dX4Q3RPPTHw;m99lZ4ECtqb.gEMvNvc0hMk;hrdP9JEX4nc;reNDEmkK2Mq.vfYirA3SzWq;reNDEmkK2Mq.gEMvNvc0hMk;GuwAYbMcdZq.vfYirA3SzWq;vSEsnqQ6Qhf;GuwAYbMcdZq.gEMvNvc0hMk;mxLNqyZYeQq;ymaZoZwUzk1.vfYirA3SzWq;ymaZoZwUzk1.gEMvNvc0hMk;GNDKguIxTOz.vfYirA3SzWq;x8AUQhbN2tg;GNDKguIxTOz.gEMvNvc0hMk;Dc3hOGg2r5f;f2omioxEuV2.vfYirA3SzWq;f2omioxEuV2.gEMvNvc0hMk;ZZS8Ta4RzBS.vfYirA3SzWq;yZUcJ8hws1s;ZZS8Ta4RzBS.gEMvNvc0hMk;uYsTCYv4x8e;ZfEH4pH2PTE.vfYirA3SzWq;ZfEH4pH2PTE.gEMvNvc0hMk;kDabi289XDq.vfYirA3SzWq;ymPffQ6e9vM;kDabi289XDq.gEMvNvc0hMk;hpWANFnMqFi;qMRBtAX5d48.vfYirA3SzWq;qMRBtAX5d48.gEMvNvc0hMk;Ixw698nRMqS.vfYirA3SzWq;VTYh6EAAlbB;Ixw698nRMqS.gEMvNvc0hMk;zJMdoIqVMRG&filter=ou:HfVjCurKxh2&displayProperty=NAME&outputIdScheme=UID`, {})
    justFetch('performance_summary.json', {})
    .then(response1=>{
        return response1
    })
    .then(response=>{
        data = ['Indicator','Value']
        indicators_ids = []
        
        response.metaData.dimensions.dx.map(o_pe=>{
        let name_i = response.metaData.items[o_pe]
        let v1_ = response.rows.find(r_=>r_[0]===o_pe) || [0, 0, 0];
        let val_arr = v1_[2]
        indicators_ids.push([o_pe,name_i,val_arr])
        })
        // target = indicators_ids.filter((item) => item[1].name.includes("TARGET"))
        // achieved = indicators_ids.filter((item) => item[1].name.includes("ACHIEVED"))
        // result = indicators_ids.filter((item) => item[1].name.includes("RESULT"))

        // target_usaid = target.filter(item => item[1].name.includes('USAID'))
        // target_ou = target.filter(item => !item[1].name.includes('USAID'))

        // achieved_usaid = achieved.filter(item => item[1].name.includes('USAID'))
        // achieved_ou = achieved.filter(item => !item[1].name.includes('USAID'))

        // result_usaid = result.filter(item => item[1].name.includes('USAID'))
        // result_ou = result.filter(item => !item[1].name.includes('USAID'))

        let pmtct_art = indicators_ids.filter((item) => item[1].name.includes("PMTCT_ART"))
        renderRow(pmtct_art,'PMTCT_ART')

        let hts_tst_pos = indicators_ids.filter((item) => item[1].name.includes("HTS_POS"))
        renderRow(hts_tst_pos,'HTS_TST_POS')

        let pmtct_stat = indicators_ids.filter((item) => item[1].name.includes("PMTCT_STAT "))
        renderRow(pmtct_stat,'PMTCT_STAT')

        let pmtct_stat_pos = indicators_ids.filter((item) => item[1].name.includes("PMTCT_STAT_POS"))
        renderRow(pmtct_stat_pos,'PMTCT_STAT_POS')

        let tb_art = indicators_ids.filter((item) => item[1].name.includes("TB_ART"))
        renderRow(tb_art,'TB_ART')  

        let tb_stat = indicators_ids.filter((item) => item[1].name.includes("TB_STAT "))
        renderRow(tb_stat,'TB_STAT')
        
        let tb_stat_pos = indicators_ids.filter((item) => item[1].name.includes("TB_STAT_POS"))
        renderRow(tb_stat_pos,'TB_STAT_POS') 

        let tb_curr = indicators_ids.filter((item) => item[1].name.includes("TX_CURR"))
        renderRow(tb_curr,'TX_CURR') 

        let tx_new = indicators_ids.filter((item) => item[1].name.includes("TX_NEW "))
        renderRow(tx_new,'TX_NEW')  


    });
    
    // (
        function renderRow(arrData,tr_id) {
            getRow = document.getElementById(tr_id)
            tr = document.createElement('tr')
            arrData.push([1,1,1])
            nodes = arrData.map(arr => {
                // arr.forEach(a => {
                    node = document.createElement('td')

                    getRow.appendChild(tr.appendChild(node))
                
                    // node = node.textContent(arr[2])
                    // console.log(arr[2])
                    

                    return node
                    
                // })
            });
            // console.log('fa')
            
            
            nodes.forEach((n ,i)=> {
                
                if (i == 0) {
                    n.innerText = getRow['id']
                    
                }  else if (i === 1  || i ===2 || i ===3 || i ===5){
                    let values = arrData[i-1][2]
                    values = parseFloat(values)
                    n.innerText = values.toLocaleString()
                   
                }  else if (i == 4 || i == 6){
                    let values = arrData[i-1][2]
                    values = parseInt(values).toFixed(0)
                    values = (values +' %')
                    n.innerText = (values)
                }         
            })

            

        }
        // )([[1,2,3],[1,2,4],[1,2,43],[1,2,34],[1,2,53],[1,2,53]],'PMTCT_ART')
        
            
        
</script>


<!-- ------------------------ PAGE DATA LOGIC ------------------------ -->

</body>

</html>